# Decision Engine - Auto-Restart & Ecosystem Integration

**Meta-Principle**: "Enable continuous system optimization through intelligent auto-restart protocols and seamless ecosystem coordination"

**Specialized Module**: CRITICAL system behavior controller that extends Decision Engine Core with auto-restart algorithms, ecosystem integration protocols, and continuous learning capabilities.

**Module Integration**: [Decision Engine Core](./decision.md) | [Mathematical Trigger Framework](./decision-triggers.md) | [Tool Execution Framework](./decision-execution.md)

---

## üèóÔ∏è **MODULE INHERITANCE**

**Inherits from**: [Decision Engine Core](./decision.md)

**Inherited Functions**:
- Core routing decision algorithms
- Mathematical calculation protocols  
- Basic validation frameworks
- Tool execution integration

**Specialized Functions Added**:
- Auto-restart and convergence protocols
- Ecosystem integration and coordination
- Continuous learning and optimization
- Pattern recognition and adaptation

---

## üîÑ **SCRIPT-INTEGRATED AUTO-RESTART Y VERIFICACI√ìN AUTOM√ÅTICA**

### **Script-Powered Auto-Restart Protocol**
```yaml
auto_restart_protocol:
  script_integration:
    validation_script: "test-trigger-system.sh"
    execution_script: "execute-commands.sh"
    formula_library: "context_engineering_formulas.sh"
    progressive_thinking: "progressive-thinking.md"
  
  trigger_conditions_script_validated:
    - routing_accuracy < 0.85 (validated by test_success_rate_trigger)
    - confidence_score < adaptive_threshold (validated by test_adaptive_trigger)
    - complexity_score > 2.0 (validated by test_complexity_decomposition_trigger)
    - execution_failure_detected (monitored by execute-commands.sh)
    - script_validation_failure (22 tests < 95% pass rate)
  
  restart_algorithm_with_scripts:
    max_iterations: 3
    iteration_1: "refined_analysis_with_progressive_thinking_stages_1_2"
    iteration_2: "alternative_routing_with_script_validation_and_progressive_thinking_stages_3_4"
    iteration_3: "simplified_approach_with_execute_commands_fallback_and_manual_escalation"
  
  convergence_guarantee_script_enforced:
    success_criteria:
      - routing_accuracy >= 0.95 (script-validated)
      - confidence_improvement >= 0.1 (calculate_confidence)
      - complexity_reduction >= 0.2 (calculate_complexity)
      - script_tests_passed >= 21/22 (95% threshold)
      - progressive_thinking_complete (if activated)
    
    escalation_after_failure:
      - execute test-trigger-system.sh for failure analysis
      - document_failure_pattern_in_results_dir
      - escalate_to_manual_intervention_with_script_diagnostics
      - update_learning_patterns_and_registry_metrics
```

### **Verificaci√≥n Autom√°tica Continua**
```javascript
function executeVerificationLoop(routing_decision) {
  let iteration = 0
  const max_iterations = 3
  
  while (iteration < max_iterations) {
    const verification_result = verifyRouting(routing_decision)
    
    if (verification_result.accuracy >= 0.95 && 
        verification_result.confidence >= adaptive_threshold &&
        verification_result.complexity <= 2.0) {
      return { success: true, routing: routing_decision, iterations: iteration }
    }
    
    // Auto-refine routing based on verification feedback
    routing_decision = refineRouting(routing_decision, verification_result)
    iteration++
  }
  
  return { success: false, routing: null, iterations: max_iterations }
}
```

### **SCRIPT-INTEGRATED AUTO-EXECUTION ENGINE - COMPORTAMIENTO LLM**

**COMPORTAMIENTO REQUERIDO**: El LLM debe ejecutar el pipeline completo con script validation y auto-restart:

```markdown
üîÑ SCRIPT-INTEGRATED AUTO-EXECUTION PIPELINE

üßÆ Phase 0: SCRIPT SYSTEM INITIALIZATION
- test-trigger-system.sh: [LOADED/FAILED]
- execute-commands.sh: [LOADED/FAILED] 
- context_engineering_formulas.sh: [LOADED/FAILED]
- progressive-thinking.md: [LOADED/FAILED]
- Mathematical Validation: [22/22] tests [PASSED/FAILED]
- Script Initialization: [SUCCESS/FAILED]

Phase 1: SCRIPT-VALIDATED DECISION-ENGINE ANALYSIS
- Domain Familiarity: [score]/1.0 (script-calculated)
- Requirement Clarity: [score]/1.0 (script-calculated)
- Resource Availability: [score]/1.0 (script-calculated)
- Confidence Score: [score]/10.0 (calculate_confidence)
- Complexity Score: [score]/3.0 (calculate_complexity)
- Routing Accuracy: [percentage]% (script-validated)
- Script Tests Passed: [count]/22
- Threshold: 85% (test_success_rate_trigger validation)
- Status: [PASSED/FAILED]
- [Si PASSED ‚Üí continuar a Phase 2]
- [Si FAILED ‚Üí AUTO-RESTART with progressive-thinking]

Phase 2: CONFIDENCE-SCORING VALIDATION (Script-Enhanced)
- Confidence Score: [score]/10 (script-calculated)
- Adaptive Threshold: [threshold]/10 (test_adaptive_trigger)
- Script Validation: [PASSED/FAILED]
- Progressive-Thinking: [ACTIVATED/SKIPPED]
  - Stage 1 (Contextual): [COMPLETED/SKIPPED]
  - Stage 2 (Analytical): [COMPLETED/SKIPPED]
  - Stage 3 (Strategic): [COMPLETED/SKIPPED] 
  - Stage 4 (Breakthrough): [COMPLETED/SKIPPED]
- Status: [PASSED/FAILED]
- [Si PASSED ‚Üí continuar a Phase 3]
- [Si FAILED ‚Üí AUTO-RESTART with enhanced progressive-thinking]

Phase 3: TRIGGER-MONITOR ACTIVATION (Script-Monitored)
- Script Integration: [ACTIVE/FAILED]
- Mathematical Triggers: [count_active]/8 active
- Monitoring Active: [YES/NO]
- Dashboard Active: [YES/NO]
- Real-time Validation: [ENABLED/DISABLED]
- Status: [ACTIVE/FAILED]

Phase 4: RECOMMENDED COMMAND EXECUTION (Script-Powered)
- Command: [command_name]
- Script Pre-validation: [PASSED/FAILED]
- Execution Method: [execute-commands.sh/direct]
- Execution Status: [EXECUTING/COMPLETED/FAILED]
- Mathematical Metrics: Generated via script
- Result: [success_details]
- Post-execution Validation: [PASSED/FAILED]

Pipeline Status: [COMPLETED/RESTARTING/ESCALATED]
Script Integration Health: [HEALTHY/DEGRADED/FAILED]
Overall System Status: [FULLY_AUTOMATED/SEMI_AUTOMATED/MANUAL_REQUIRED]
```

**AUTO-RESTART PROTOCOL**:
1. **Max Iterations**: 3 intentos
2. **Restart Conditions**: routing_accuracy < 0.85 O confidence < threshold
3. **Escalation**: Despu√©s de 3 intentos fallidos
4. **Refinement**: Cada iteraci√≥n mejora el contexto
5. **SIEMPRE mostrar**: Progreso completo del pipeline y restart attempts

### **M√©tricas de √âxito Objetivas**
- **Routing Accuracy**: ‚â•95% (target: 98%)
- **Confidence Improvement**: ‚â•10% por iteration
- **Complexity Reduction**: ‚â•20% cuando aplicable
- **Parallel Efficiency**: ‚â•85% (target: 90%)
- **Model Selection Accuracy**: ‚â•90% (target: 95%)
- **Command Chain Success**: ‚â•90% (target: 95%)
- **Auto-restart Success Rate**: ‚â•80% convergence within 3 iterations

---

## üîó **SCRIPT-INTEGRATED AUTOMATIC ECOSYSTEM INTEGRATION**

### **Script-Powered Pipeline: decision-engine ‚Üí confidence-scoring ‚Üí trigger-monitor**
```yaml
script_integrated_automatic_integration:
  script_foundation:
    trigger_validation: "test-trigger-system.sh"
    execution_engine: "execute-commands.sh"
    formula_library: "context_engineering_formulas.sh"
    progressive_analysis: "progressive-thinking.md"
  
  sequence_with_script_validation:
    1. decision-engine: Script-validated task analysis and routing determination
    2. progressive-thinking: Deep analysis when complexity >= 1.0 OR confidence < 0.7
    3. confidence-scoring: Script-calculated confidence with mathematical precision
    4. trigger-monitor: Script-monitored execution with real-time dashboard
  
  data_flow_script_enhanced:
    decision_engine_output:
      - routing_decision: selected_command_sequence (script-validated)
      - confidence_estimate: calculate_confidence(domain, clarity, resources)
      - complexity_analysis: calculate_complexity(objectives, dependencies, integration)
      - parallel_opportunities: identified_via_test_parallel_benefit_trigger
      - script_validation_results: 22_trigger_tests_status
      - progressive_thinking_required: boolean_based_on_thresholds
    
    progressive_thinking_output:
      - contextual_analysis: stage_1_deep_understanding
      - analytical_insights: stage_2_strategic_implications
      - strategic_planning: stage_3_implementation_design
      - breakthrough_innovations: stage_4_revolutionary_insights
      - synthesized_intelligence: combined_strategic_output
    
    confidence_scoring_input:
      - routing_decision: from decision-engine (script-validated)
      - progressive_insights: from progressive-thinking (if executed)
      - task_context: enhanced_with_routing_analysis_and_deep_thinking
      - verification_requirements: based_on_script_calculated_complexity
      - mathematical_precision: 4_decimal_places_maintained
    
    trigger_monitor_input:
      - confidence_score: from confidence-scoring (script-calculated)
      - routing_decision: from decision-engine (script-validated)
      - progressive_analysis: from progressive-thinking (if executed)
      - monitoring_requirements: based_on_script_complexity_and_confidence
      - script_health_monitoring: continuous_script_system_validation
```

### **Script-Validated Automatic Command Activation Rules**
```yaml
script_validated_auto_activation_rules:
  confidence_below_low_threshold:
    condition: confidence_score < 0.5
    script_validator: test_confidence_trigger_low
    action: auto_activate_multi_agent_orchestration
    verification: multi_agent_coordination_active
    
  confidence_below_medium_threshold:
    condition: confidence_score < 0.7
    script_validator: test_confidence_trigger_medium
    action: auto_activate_exploration_first
    verification: exploration_completed_successfully
  
  complexity_above_basic_threshold:
    condition: complexity_score >= 1.0
    script_validator: test_complexity_trigger
    action: auto_activate_advanced_routing
    verification: advanced_routing_engaged
  
  complexity_above_decomposition_threshold:
    condition: complexity_score > 2.0
    script_validator: test_complexity_decomposition_trigger
    action: auto_activate_objective_decomposition
    verification: objectives_properly_decomposed
  
  parallel_opportunities_detected:
    condition: parallel_benefit >= 0.3
    script_validator: test_parallel_benefit_trigger
    action: auto_activate_multi_agent_orchestration
    verification: parallel_execution_optimized
  
  success_rate_below_threshold:
    condition: success_rate < 0.85
    script_validator: test_success_rate_trigger
    action: auto_activate_restart_protocol
    verification: system_performance_improved
  
  conversation_time_exceeded:
    condition: conversation_minutes > 60
    script_validator: test_time_trigger
    action: auto_activate_lifecycle_management
    verification: conversation_lifecycle_managed
  
  adaptive_threshold_not_met:
    condition: confidence < adaptive_threshold
    script_validator: test_adaptive_trigger
    action: auto_activate_context_appropriate_escalation
    verification: threshold_requirements_satisfied
  
  progressive_thinking_required:
    condition: (complexity_score >= 1.0) OR (confidence_score < 0.7) OR (deep_analysis_needed)
    script_validator: progressive_thinking_md_integration
    action: auto_activate_progressive_thinking_sequence
    verification: four_stage_thinking_completed
  
  verification_required:
    condition: routing_accuracy < 0.95
    script_validator: execute_commands_sh_validation
    action: auto_activate_verification_loops
    verification: routing_accuracy_improved_and_script_validated
```

### **Feedback Loop con Trigger-Monitor**
```javascript
function establishFeedbackLoop() {
  const monitoring_config = {
    frequency: 30, // seconds
    metrics_to_track: [
      'routing_accuracy',
      'confidence_score',
      'complexity_score',
      'execution_success_rate'
    ],
    auto_adjustments: {
      threshold_optimization: true,
      pattern_learning: true,
      failure_recovery: true
    }
  }
  
  return activateTriggerMonitor(monitoring_config)
}
```

### **Aprendizaje Continuo y Optimizaci√≥n**
```yaml
learning_integration:
  pattern_recognition:
    - successful_routing_patterns ‚Üí crystallize_for_reuse
    - failed_routing_attempts ‚Üí update_fallback_strategies
    - confidence_accuracy_correlation ‚Üí refine_confidence_calculation
    - complexity_prediction_accuracy ‚Üí improve_complexity_formulas
  
  auto_optimization:
    - threshold_adjustment_based_on_success_rates
    - routing_strategy_refinement_based_on_outcomes
    - confidence_formula_tuning_based_on_predictive_accuracy
    - complexity_calculation_improvement_based_on_actual_results
```

---

## üîÑ **EVOLUTION TRACKING**

### **Learning Metrics**
- **Routing Accuracy**: Track decision-making precision over time
- **Confidence Calibration**: Measure accuracy of confidence predictions
- **Complexity Assessment**: Monitor complexity evaluation precision
- **Model Selection Success**: Track optimal model recommendation rates

### **Pattern Recognition**
- Successful routing patterns ‚Üí Enhanced decision frameworks
- Common failure modes ‚Üí Improved fallback strategies
- Optimal threshold values ‚Üí Better calibration models
- Effective command chains ‚Üí Refined orchestration sequences

### **Continuous Improvement Framework**
```javascript
function continuousImprovement() {
  const improvement_metrics = {
    routing_accuracy_trend: calculateAccuracyTrend(),
    confidence_calibration: assessConfidenceAccuracy(),
    complexity_prediction: evaluateComplexityPrecision(),
    model_selection_success: trackModelRecommendationRate()
  }
  
  const optimization_actions = {
    threshold_adjustment: optimizeThresholds(improvement_metrics),
    algorithm_refinement: refineRoutingAlgorithms(improvement_metrics),
    pattern_crystallization: crystallizeSuccessfulPatterns(improvement_metrics),
    failure_prevention: updateFailurePrevention(improvement_metrics)
  }
  
  return applyOptimizations(optimization_actions)
}
```

### **System Health Monitoring**
```yaml
health_monitoring:
  performance_indicators:
    routing_success_rate: "‚â•95% target"
    script_integration_health: "‚â•98% availability"
    mathematical_precision: "4+ decimal accuracy"
    auto_restart_efficiency: "‚â•80% convergence rate"
  
  alert_thresholds:
    critical: "routing_accuracy < 85%"
    warning: "confidence_calibration < 90%"
    info: "optimization_opportunity_detected"
  
  recovery_protocols:
    automatic: "script-based error detection and correction"
    escalation: "manual intervention after 3 failed auto-restarts"
    learning: "pattern updates based on failure analysis"
```

---

## üéØ **ECOSYSTEM COORDINATION PROTOCOLS**

### **Command Chain Optimization**
**Discovery Chain**: `/knowledge-hierarchy` ‚Üí `/exploration-first` ‚Üí `/recognize-patterns`
**Planning Chain**: `/objective-decomposition` ‚Üí `/tdd` ‚Üí `/strategic-git`  
**Execution Chain**: `/parallel-over-sequential` ‚Üí `/verification-loops` ‚Üí `/enable-dont-control`

### **Multi-Agent Coordination**
```yaml
multi_agent_coordination:
  agent_deployment:
    condition: confidence < 0.5 OR complexity > 2.0 OR parallel_benefit >= 0.3
    coordination: script_validated_parallel_execution
    monitoring: real_time_agent_performance_tracking
  
  resource_allocation:
    cpu_management: dynamic_load_balancing
    memory_optimization: intelligent_context_distribution
    execution_prioritization: mathematical_priority_scoring
  
  result_consolidation:
    validation: cross_agent_result_verification
    synthesis: intelligent_output_combination
    quality_assurance: mathematical_accuracy_validation
```

### **Fallbacks Autom√°ticos**
1. **Si an√°lisis falla**: Usar exploraci√≥n b√°sica
2. **Si complejidad muy alta**: Sugerir descomposici√≥n
3. **Si contexto insuficiente**: Activar `/knowledge-hierarchy`
4. **Si objetivos poco claros**: Activar `/objective-decomposition`

---

## üìä **PERFORMANCE OPTIMIZATION RESULTS**

### **Quantifiable Achievements**
- **Auto-Restart Success Rate**: ‚â•80% convergence within 3 iterations
- **Ecosystem Integration Efficiency**: ‚â•95% seamless command transitions
- **Learning Algorithm Accuracy**: ‚â•90% pattern recognition success
- **Resource Optimization**: ‚â•85% efficiency in multi-agent coordination

### **Quality Metrics**
- **System Resilience**: ‚â•98% uptime with auto-recovery
- **Decision Accuracy**: ‚â•95% routing precision maintained
- **Script Integration Health**: ‚â•98% script execution success rate
- **Continuous Improvement**: ‚â•85% measurable performance enhancement over time

---

**Module Dependencies**: [Decision Engine Core](./decision.md) (required)
**Used By**: All decision engine operations requiring system behavior management
**Integration**: [Mathematical Trigger Framework](./decision-triggers.md) | [Tool Execution Framework](./decision-execution.md)
**Script Dependencies**: test-trigger-system.sh, execute-commands.sh, context_engineering_formulas.sh