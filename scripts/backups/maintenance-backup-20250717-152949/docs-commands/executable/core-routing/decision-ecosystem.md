# Decision Engine - Auto-Restart & Ecosystem Integration

**Meta-Principle**: "Enable continuous system optimization through intelligent auto-restart protocols and seamless ecosystem coordination"

**Specialized Module**: CRITICAL system behavior controller that extends Decision Engine Core with auto-restart algorithms, ecosystem integration protocols, and continuous learning capabilities.

**Module Integration**: [Decision Engine Core](./decision.md) | [Mathematical Trigger Framework](./decision-triggers.md) | [Tool Execution Framework](./decision-execution.md)

---

## üèóÔ∏è **MODULE INHERITANCE**

**Inherits from**: [Decision Engine Core](./decision.md)

**Inherited Functions**:
- Core routing decision algorithms
- Mathematical calculation protocols  
- Basic validation frameworks
- Tool execution integration

**Specialized Functions Added**:
- Auto-restart and convergence protocols
- Ecosystem integration and coordination
- Continuous learning and optimization
- Pattern recognition and adaptation

---

## üîÑ **SCRIPT-INTEGRATED AUTO-RESTART Y VERIFICACI√ìN AUTOM√ÅTICA**

### **Script-Powered Auto-Restart Protocol**

**CRITICAL Script Integration Requirements**:
- **Validation Script**: REQUIRE test-trigger-system.sh for trigger validation
- **Execution Script**: REQUIRE execute-commands.sh for command execution
- **Formula Library**: REQUIRE context_engineering_formulas.sh for mathematical calculations
- **Progressive Thinking**: REQUIRE progressive-thinking.md for deep analysis

**MANDATORY Trigger Conditions Script-Validated**:
- **Routing Accuracy**: Activate when routing_accuracy < 0.85 (validated by test_success_rate_trigger)
- **Confidence Score**: Activate when confidence_score < adaptive_threshold (validated by test_adaptive_trigger)
- **Complexity Score**: Activate when complexity_score > 2.0 (validated by test_complexity_decomposition_trigger)
- **Execution Failure**: Activate when execution_failure_detected (monitored by execute-commands.sh)
- **Script Validation Failure**: Activate when script_validation_failure (22 tests < 95% pass rate)

**REQUIRED Restart Algorithm with Scripts**:
- **Maximum Iterations**: LIMIT to 3 restart attempts
- **Iteration 1**: Execute refined_analysis_with_progressive_thinking_stages_1_2
- **Iteration 2**: Execute alternative_routing_with_script_validation_and_progressive_thinking_stages_3_4
- **Iteration 3**: Execute simplified_approach_with_execute_commands_fallback_and_manual_escalation

**MANDATORY Convergence Guarantee Script-Enforced Success Criteria**:
- **Routing Accuracy**: REQUIRE routing_accuracy >= 0.95 (script-validated)
- **Confidence Improvement**: REQUIRE confidence_improvement >= 0.1 (calculate_confidence)
- **Complexity Reduction**: REQUIRE complexity_reduction >= 0.2 (calculate_complexity)
- **Script Tests Passed**: REQUIRE script_tests_passed >= 21/22 (95% threshold)
- **Progressive Thinking Complete**: REQUIRE completion if activated

**CRITICAL Escalation After Failure Process**:
- **Failure Analysis**: Execute test-trigger-system.sh for failure analysis
- **Pattern Documentation**: Document failure pattern in results directory
- **Manual Escalation**: Escalate to manual intervention with script diagnostics
- **Learning Updates**: Update learning patterns and registry metrics

### **Verificaci√≥n Autom√°tica Continua**

**MANDATORY Verification Loop Process**:
- **Iteration Management**: Initialize iteration counter at 0 with maximum 3 iterations
- **Verification Execution**: Execute verifyRouting function on routing_decision for each iteration
- **Success Criteria Validation**: Check if verification_result meets all success conditions
- **Accuracy Requirement**: REQUIRE verification_result.accuracy >= 0.95
- **Confidence Requirement**: REQUIRE verification_result.confidence >= adaptive_threshold
- **Complexity Requirement**: REQUIRE verification_result.complexity <= 2.0
- **Success Response**: Return success as true with routing_decision and iteration count when criteria met
- **Auto-Refinement**: Execute refineRouting based on verification feedback when criteria not met
- **Iteration Increment**: Increment iteration counter and continue loop
- **Failure Response**: Return success as false with null routing after max_iterations reached

**P56 Transparency**: All verification loop results MUST be documented with specific iteration counts and success/failure status

### **SCRIPT-INTEGRATED AUTO-EXECUTION ENGINE - COMPORTAMIENTO LLM**

**COMPORTAMIENTO REQUERIDO**: El LLM debe ejecutar el pipeline completo con script validation y auto-restart:

**CRITICAL Script-Integrated Auto-Execution Pipeline Display**:

**MANDATORY Phase 0: Script System Initialization**:
- **test-trigger-system.sh**: Display LOADED/FAILED status
- **execute-commands.sh**: Display LOADED/FAILED status
- **context_engineering_formulas.sh**: Display LOADED/FAILED status
- **progressive-thinking.md**: Display LOADED/FAILED status
- **Mathematical Validation**: Show 22/22 tests PASSED/FAILED status
- **Script Initialization**: Display SUCCESS/FAILED initialization status

**REQUIRED Phase 1: Script-Validated Decision-Engine Analysis**:
- **Domain Familiarity**: Display score/1.0 (script-calculated)
- **Requirement Clarity**: Display score/1.0 (script-calculated)
- **Resource Availability**: Display score/1.0 (script-calculated)
- **Confidence Score**: Display score/10.0 (calculate_confidence)
- **Complexity Score**: Display score/3.0 (calculate_complexity)
- **Routing Accuracy**: Display percentage (script-validated)
- **Script Tests Passed**: Display count/22
- **Threshold**: 85% (test_success_rate_trigger validation)
- **Status**: Display PASSED/FAILED
- **Next Action**: If PASSED continue to Phase 2, if FAILED AUTO-RESTART with progressive-thinking

**MANDATORY Phase 2: Confidence-Scoring Validation (Script-Enhanced)**:
- **Confidence Score**: Display score/10 (script-calculated)
- **Adaptive Threshold**: Display threshold/10 (test_adaptive_trigger)
- **Script Validation**: Display PASSED/FAILED
- **Progressive-Thinking**: Display ACTIVATED/SKIPPED with stage completion status
- **Stage 1 (Contextual)**: Display COMPLETED/SKIPPED
- **Stage 2 (Analytical)**: Display COMPLETED/SKIPPED
- **Stage 3 (Strategic)**: Display COMPLETED/SKIPPED
- **Stage 4 (Breakthrough)**: Display COMPLETED/SKIPPED
- **Status**: Display PASSED/FAILED
- **Next Action**: If PASSED continue to Phase 3, if FAILED AUTO-RESTART with enhanced progressive-thinking

**CRITICAL Phase 3: Trigger-Monitor Activation (Script-Monitored)**:
- **Script Integration**: Display ACTIVE/FAILED
- **Mathematical Triggers**: Display count_active/8 active
- **Monitoring Active**: Display YES/NO
- **Dashboard Active**: Display YES/NO
- **Real-time Validation**: Display ENABLED/DISABLED
- **Status**: Display ACTIVE/FAILED

**REQUIRED Phase 4: Recommended Command Execution (Script-Powered)**:
- **Command**: Display command_name
- **Script Pre-validation**: Display PASSED/FAILED
- **Execution Method**: Display execute-commands.sh/direct
- **Execution Status**: Display EXECUTING/COMPLETED/FAILED
- **Mathematical Metrics**: Display generated via script
- **Result**: Display success_details
- **Post-execution Validation**: Display PASSED/FAILED

**MANDATORY Pipeline Status Display**:
- **Pipeline Status**: Display COMPLETED/RESTARTING/ESCALATED
- **Script Integration Health**: Display HEALTHY/DEGRADED/FAILED
- **Overall System Status**: Display FULLY_AUTOMATED/SEMI_AUTOMATED/MANUAL_REQUIRED

**AUTO-RESTART PROTOCOL**:
1. **Max Iterations**: 3 intentos
2. **Restart Conditions**: routing_accuracy < 0.85 O confidence < threshold
3. **Escalation**: Despu√©s de 3 intentos fallidos
4. **Refinement**: Cada iteraci√≥n mejora el contexto
5. **SIEMPRE mostrar**: Progreso completo del pipeline y restart attempts

### **M√©tricas de √âxito Objetivas**
- **Routing Accuracy**: ‚â•95% (target: 98%)
- **Confidence Improvement**: ‚â•10% por iteration
- **Complexity Reduction**: ‚â•20% cuando aplicable
- **Parallel Efficiency**: ‚â•85% (target: 90%)
- **Model Selection Accuracy**: ‚â•90% (target: 95%)
- **Command Chain Success**: ‚â•90% (target: 95%)
- **Auto-restart Success Rate**: ‚â•80% convergence within 3 iterations

---

## üîó **SCRIPT-INTEGRATED AUTOMATIC ECOSYSTEM INTEGRATION**

### **Script-Powered Pipeline: decision-engine ‚Üí confidence-scoring ‚Üí trigger-monitor**

**CRITICAL Script Integrated Automatic Integration Requirements**:

**MANDATORY Script Foundation**:
- **Trigger Validation**: REQUIRE test-trigger-system.sh for trigger validation
- **Execution Engine**: REQUIRE execute-commands.sh for command execution
- **Formula Library**: REQUIRE context_engineering_formulas.sh for mathematical calculations
- **Progressive Analysis**: REQUIRE progressive-thinking.md for deep analysis

**REQUIRED Sequence with Script Validation**:
1. **decision-engine**: Execute script-validated task analysis and routing determination
2. **progressive-thinking**: Execute deep analysis when complexity >= 1.0 OR confidence < 0.7
3. **confidence-scoring**: Execute script-calculated confidence with mathematical precision
4. **trigger-monitor**: Execute script-monitored execution with real-time dashboard

**MANDATORY Data Flow Script Enhanced**:

**Decision Engine Output Requirements**:
- **Routing Decision**: Provide selected_command_sequence (script-validated)
- **Confidence Estimate**: Calculate confidence using domain, clarity, resources parameters
- **Complexity Analysis**: Calculate complexity using objectives, dependencies, integration parameters
- **Parallel Opportunities**: Identify via test_parallel_benefit_trigger
- **Script Validation Results**: Provide 22_trigger_tests_status
- **Progressive Thinking Required**: Provide boolean based on thresholds

**Progressive Thinking Output Requirements**:
- **Contextual Analysis**: Provide stage_1_deep_understanding
- **Analytical Insights**: Provide stage_2_strategic_implications
- **Strategic Planning**: Provide stage_3_implementation_design
- **Breakthrough Innovations**: Provide stage_4_revolutionary_insights
- **Synthesized Intelligence**: Provide combined_strategic_output

**Confidence Scoring Input Requirements**:
- **Routing Decision**: Accept from decision-engine (script-validated)
- **Progressive Insights**: Accept from progressive-thinking (if executed)
- **Task Context**: Accept enhanced_with_routing_analysis_and_deep_thinking
- **Verification Requirements**: Accept based_on_script_calculated_complexity
- **Mathematical Precision**: REQUIRE 4_decimal_places_maintained

**Trigger Monitor Input Requirements**:
- **Confidence Score**: Accept from confidence-scoring (script-calculated)
- **Routing Decision**: Accept from decision-engine (script-validated)
- **Progressive Analysis**: Accept from progressive-thinking (if executed)
- **Monitoring Requirements**: Accept based_on_script_complexity_and_confidence
- **Script Health Monitoring**: REQUIRE continuous_script_system_validation

### **Script-Validated Automatic Command Activation Rules**

**CRITICAL Script-Validated Auto-Activation Rules**:

**MANDATORY Confidence Below Low Threshold**:
- **Condition**: Activate when confidence_score < 0.5
- **Script Validator**: Use test_confidence_trigger_low for validation
- **Action**: Execute auto_activate_multi_agent_orchestration
- **Verification**: Confirm multi_agent_coordination_active

**REQUIRED Confidence Below Medium Threshold**:
- **Condition**: Activate when confidence_score < 0.7
- **Script Validator**: Use test_confidence_trigger_medium for validation
- **Action**: Execute auto_activate_exploration_first
- **Verification**: Confirm exploration_completed_successfully

**MANDATORY Complexity Above Basic Threshold**:
- **Condition**: Activate when complexity_score >= 1.0
- **Script Validator**: Use test_complexity_trigger for validation
- **Action**: Execute auto_activate_advanced_routing
- **Verification**: Confirm advanced_routing_engaged

**CRITICAL Complexity Above Decomposition Threshold**:
- **Condition**: Activate when complexity_score > 2.0
- **Script Validator**: Use test_complexity_decomposition_trigger for validation
- **Action**: Execute auto_activate_objective_decomposition
- **Verification**: Confirm objectives_properly_decomposed

**REQUIRED Parallel Opportunities Detected**:
- **Condition**: Activate when parallel_benefit >= 0.3
- **Script Validator**: Use test_parallel_benefit_trigger for validation
- **Action**: Execute auto_activate_multi_agent_orchestration
- **Verification**: Confirm parallel_execution_optimized

**MANDATORY Success Rate Below Threshold**:
- **Condition**: Activate when success_rate < 0.85
- **Script Validator**: Use test_success_rate_trigger for validation
- **Action**: Execute auto_activate_restart_protocol
- **Verification**: Confirm system_performance_improved

**CRITICAL Conversation Time Exceeded**:
- **Condition**: Activate when conversation_minutes > 60
- **Script Validator**: Use test_time_trigger for validation
- **Action**: Execute auto_activate_lifecycle_management
- **Verification**: Confirm conversation_lifecycle_managed

**REQUIRED Adaptive Threshold Not Met**:
- **Condition**: Activate when confidence < adaptive_threshold
- **Script Validator**: Use test_adaptive_trigger for validation
- **Action**: Execute auto_activate_context_appropriate_escalation
- **Verification**: Confirm threshold_requirements_satisfied

**MANDATORY Progressive Thinking Required**:
- **Condition**: Activate when (complexity_score >= 1.0) OR (confidence_score < 0.7) OR (deep_analysis_needed)
- **Script Validator**: Use progressive_thinking_md_integration for validation
- **Action**: Execute auto_activate_progressive_thinking_sequence
- **Verification**: Confirm four_stage_thinking_completed

**CRITICAL Verification Required**:
- **Condition**: Activate when routing_accuracy < 0.95
- **Script Validator**: Use execute_commands_sh_validation for validation
- **Action**: Execute auto_activate_verification_loops
- **Verification**: Confirm routing_accuracy_improved_and_script_validated

### **Feedback Loop con Trigger-Monitor**

**MANDATORY Feedback Loop Process**:
- **Monitoring Configuration Setup**: Initialize monitoring system with specified parameters
- **Frequency Setting**: Set monitoring frequency to 30 seconds
- **Metrics Tracking Requirements**: Track routing_accuracy, confidence_score, complexity_score, and execution_success_rate
- **Auto-Adjustments Configuration**: Enable threshold_optimization, pattern_learning, and failure_recovery
- **Trigger Monitor Activation**: Execute activateTriggerMonitor with monitoring configuration
- **P56 Transparency**: All feedback loop operations MUST be documented with specific monitoring parameters and activation results

### **Aprendizaje Continuo y Optimizaci√≥n**

**CRITICAL Learning Integration Requirements**:

**MANDATORY Pattern Recognition**:
- **Successful Routing Patterns**: Crystallize successful patterns for reuse
- **Failed Routing Attempts**: Update fallback strategies based on failures
- **Confidence Accuracy Correlation**: Refine confidence calculation accuracy
- **Complexity Prediction Accuracy**: Improve complexity formula precision

**REQUIRED Auto-Optimization**:
- **Threshold Adjustment**: Base adjustments on success rates
- **Routing Strategy Refinement**: Base improvements on outcomes
- **Confidence Formula Tuning**: Base tuning on predictive accuracy
- **Complexity Calculation Improvement**: Base improvements on actual results

**P56 Transparency**: All learning integration activities MUST be documented with specific pattern recognition results and optimization improvements

---

## üîÑ **EVOLUTION TRACKING**

### **Learning Metrics**
- **Routing Accuracy**: Track decision-making precision over time
- **Confidence Calibration**: Measure accuracy of confidence predictions
- **Complexity Assessment**: Monitor complexity evaluation precision
- **Model Selection Success**: Track optimal model recommendation rates

### **Pattern Recognition**
- Successful routing patterns ‚Üí Enhanced decision frameworks
- Common failure modes ‚Üí Improved fallback strategies
- Optimal threshold values ‚Üí Better calibration models
- Effective command chains ‚Üí Refined orchestration sequences

### **Continuous Improvement Framework**

**MANDATORY Continuous Improvement Process**:
- **Improvement Metrics Collection**: Gather routing_accuracy_trend, confidence_calibration, complexity_prediction, and model_selection_success data
- **Routing Accuracy Trend**: Calculate accuracy trend using calculateAccuracyTrend function
- **Confidence Calibration**: Assess confidence accuracy using assessConfidenceAccuracy function
- **Complexity Prediction**: Evaluate complexity precision using evaluateComplexityPrecision function
- **Model Selection Success**: Track model recommendation rate using trackModelRecommendationRate function

**CRITICAL Optimization Actions**:
- **Threshold Adjustment**: Optimize thresholds based on improvement metrics
- **Algorithm Refinement**: Refine routing algorithms based on improvement metrics
- **Pattern Crystallization**: Crystallize successful patterns based on improvement metrics
- **Failure Prevention**: Update failure prevention based on improvement metrics
- **Optimization Application**: Apply all optimization actions to system

**P56 Transparency**: All continuous improvement activities MUST be documented with specific metrics and optimization results

### **System Health Monitoring**

**CRITICAL Health Monitoring Requirements**:

**MANDATORY Performance Indicators**:
- **Routing Success Rate**: Target ‚â•95% success rate
- **Script Integration Health**: Target ‚â•98% availability
- **Mathematical Precision**: Target 4+ decimal accuracy
- **Auto Restart Efficiency**: Target ‚â•80% convergence rate

**REQUIRED Alert Thresholds**:
- **Critical**: Activate when routing_accuracy < 85%
- **Warning**: Activate when confidence_calibration < 90%
- **Info**: Activate when optimization_opportunity_detected

**MANDATORY Recovery Protocols**:
- **Automatic**: Execute script-based error detection and correction
- **Escalation**: Execute manual intervention after 3 failed auto-restarts
- **Learning**: Execute pattern updates based on failure analysis

**P56 Transparency**: All health monitoring activities MUST be documented with specific performance indicators and recovery protocol results

---

## üéØ **ECOSYSTEM COORDINATION PROTOCOLS**

### **Command Chain Optimization**
**Discovery Chain**: `/knowledge-hierarchy` ‚Üí `/exploration-first` ‚Üí `/recognize-patterns`
**Planning Chain**: `/objective-decomposition` ‚Üí `/tdd` ‚Üí `/strategic-git`  
**Execution Chain**: `/parallel-over-sequential` ‚Üí `/verification-loops` ‚Üí `/enable-dont-control`

### **Multi-Agent Coordination**

**CRITICAL Multi-Agent Coordination Requirements**:

**MANDATORY Agent Deployment**:
- **Condition**: Deploy agents when confidence < 0.5 OR complexity > 2.0 OR parallel_benefit >= 0.3
- **Coordination**: Execute script_validated_parallel_execution
- **Monitoring**: Implement real_time_agent_performance_tracking

**REQUIRED Resource Allocation**:
- **CPU Management**: Execute dynamic_load_balancing
- **Memory Optimization**: Execute intelligent_context_distribution
- **Execution Prioritization**: Execute mathematical_priority_scoring

**MANDATORY Result Consolidation**:
- **Validation**: Execute cross_agent_result_verification
- **Synthesis**: Execute intelligent_output_combination
- **Quality Assurance**: Execute mathematical_accuracy_validation

**P56 Transparency**: All multi-agent coordination activities MUST be documented with specific deployment conditions and resource allocation results

### **Fallbacks Autom√°ticos**
1. **Si an√°lisis falla**: Usar exploraci√≥n b√°sica
2. **Si complejidad muy alta**: Sugerir descomposici√≥n
3. **Si contexto insuficiente**: Activar `/knowledge-hierarchy`
4. **Si objetivos poco claros**: Activar `/objective-decomposition`

---

## üìä **PERFORMANCE OPTIMIZATION RESULTS**

### **Quantifiable Achievements**
- **Auto-Restart Success Rate**: ‚â•80% convergence within 3 iterations
- **Ecosystem Integration Efficiency**: ‚â•95% seamless command transitions
- **Learning Algorithm Accuracy**: ‚â•90% pattern recognition success
- **Resource Optimization**: ‚â•85% efficiency in multi-agent coordination

### **Quality Metrics**
- **System Resilience**: ‚â•98% uptime with auto-recovery
- **Decision Accuracy**: ‚â•95% routing precision maintained
- **Script Integration Health**: ‚â•98% script execution success rate
- **Continuous Improvement**: ‚â•85% measurable performance enhancement over time

---

**Module Dependencies**: [Decision Engine Core](./decision.md) (required)
**Used By**: All decision engine operations requiring system behavior management
**Integration**: [Mathematical Trigger Framework](./decision-triggers.md) | [Tool Execution Framework](./decision-execution.md)
**Script Dependencies**: test-trigger-system.sh, execute-commands.sh, context_engineering_formulas.sh